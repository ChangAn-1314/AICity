{
  "id": "snapshot_1764769330350_3s3ftgm6t",
  "approvalId": "approval_1764769330324_fp11g19rg",
  "approvalTitle": "Tasks - AI City 前端任务清单",
  "version": 1,
  "timestamp": "2025-12-03T13:42:10.350Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document - AI City 前端系统\r\n\r\n## 1. 状态管理层\r\n\r\n- [ ] 1.1 创建 Pinia Store 模块化结构\r\n\r\n  - File: `src/stores/index.js`, `src/stores/modules/`\r\n  - 重构现有 stores/index.js，拆分为模块化结构\r\n  - 创建 mapStore, opinionStore, analysisStore, simulationStore\r\n  - Purpose: 建立状态管理基础架构\r\n  - _Leverage: 现有 stores/index.js_\r\n  - _Requirements: REQ-1, REQ-2, REQ-3, REQ-4_\r\n  - _Prompt: Implement the task for spec aicity-frontend, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Vue/Pinia 状态管理专家 | Task: 重构 stores/index.js，创建模块化 Pinia Store 结构，包含 mapStore (地图状态)、opinionStore (舆情数据)、analysisStore (分析结果)、simulationStore (模拟状态) | Restrictions: 遵循 Pinia 组合式 API 风格，不使用 Options API；保持向后兼容 | Success: 所有 Store 模块正确导出，可在组件中通过 useXxxStore() 访问 | Instructions: 在 tasks.md 中将此任务标记为 [-] 进行中，完成后使用 log-implementation 记录，然后标记为 [x] 完成_\r\n\r\n- [ ] 1.2 实现 opinionStore 核心功能\r\n\r\n  - File: `src/stores/modules/opinionStore.js`\r\n  - 实现舆情列表状态、筛选条件、选中项管理\r\n  - 添加 actions: fetchOpinions, addOpinion, selectOpinion\r\n  - Purpose: 管理舆情数据状态\r\n  - _Leverage: src/stores/modules/_\r\n  - _Requirements: REQ-2_\r\n  - _Prompt: Implement the task for spec aicity-frontend, first run spec-workflow-guide: Role: Pinia Store 开发者 | Task: 实现 opinionStore，包含 state (opinions[], selectedId, filters)，getters (filteredOpinions, selectedOpinion)，actions (fetchOpinions, addOpinion, selectOpinion, clearSelection) | Restrictions: 使用 TypeScript 类型注解；actions 需处理加载状态和错误 | Success: Store 可正确管理舆情列表和选中状态_\r\n\r\n- [ ] 1.3 实现 mapStore 地图状态管理\r\n  - File: `src/stores/modules/mapStore.js`\r\n  - 管理地图中心点、缩放级别、当前区域、图层显隐\r\n  - 添加 actions: setCenter, setZoom, setRegion, toggleLayer\r\n  - Purpose: 集中管理地图视图状态\r\n  - _Leverage: src/stores/modules/_\r\n  - _Requirements: REQ-1, REQ-5_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: 地图状态管理开发者 | Task: 实现 mapStore，包含 center, zoom, currentRegion, regionLevel (province/city/district), visibleLayers | Restrictions: 支持区域层级切换；与高德地图 API 状态同步 | Success: 地图状态变化可驱动组件更新_\r\n\r\n## 2. 服务层\r\n\r\n- [ ] 2.1 创建 API 服务基础封装\r\n\r\n  - File: `src/api/index.js`, `src/api/request.js`\r\n  - 封装 axios/fetch 请求，统一错误处理\r\n  - 配置基础 URL、超时、拦截器\r\n  - Purpose: 提供统一的 API 调用基础\r\n  - _Leverage: 无现有代码，新建_\r\n  - _Requirements: REQ-2, REQ-3_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: API 架构师 | Task: 创建 request.js 封装 fetch/axios，包含请求拦截器 (添加 token)、响应拦截器 (统一错误处理)、超时配置 | Restrictions: 错误需抛出统一格式；支持取消请求 | Success: 可通过 request.get/post 发起请求并自动处理错误_\r\n\r\n- [ ] 2.2 实现 opinionService 舆情 API\r\n\r\n  - File: `src/api/opinionService.js`\r\n  - 封装舆情 CRUD 接口调用\r\n  - 提供 mock 数据用于开发阶段\r\n  - Purpose: 封装舆情数据接口\r\n  - _Leverage: src/api/request.js_\r\n  - _Requirements: REQ-2_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: API 服务开发者 | Task: 创建 opinionService，包含 getOpinions(filters), getOpinionById(id), getOpinionsByRegion(regionCode)；开发阶段返回 mock 数据 | Restrictions: 接口设计需符合 RESTful 规范；mock 数据需覆盖各种舆情类型 | Success: 可调用服务获取舆情数据_\r\n\r\n- [ ] 2.3 实现 WebSocket 服务封装\r\n  - File: `src/api/wsService.js`\r\n  - 封装 Socket.io 连接、断线重连、事件订阅\r\n  - 提供 connect, disconnect, subscribe, unsubscribe 方法\r\n  - Purpose: 实现实时舆情推送\r\n  - _Leverage: socket.io-client (已安装)_\r\n  - _Requirements: REQ-2_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: WebSocket 专家 | Task: 封装 wsService，实现自动重连 (指数退避)、心跳检测、事件订阅/取消、连接状态管理 | Restrictions: 需处理断线期间的消息缓存；提供连接状态 reactive 变量 | Success: 可订阅舆情推送事件，断线自动重连_\r\n\r\n## 3. 地图组件扩展\r\n\r\n- [ ] 3.1 扩展 CityMap3D-AMap.vue 添加 Props/Emits\r\n\r\n  - File: `src/components/features/Map/CityMap3D-AMap.vue`\r\n  - 添加 Props: center, zoom, opinions\r\n  - 添加 Emits: opinion-click, region-click, map-ready\r\n  - Purpose: 使地图组件可控制和可响应\r\n  - _Leverage: 现有 CityMap3D-AMap.vue_\r\n  - _Requirements: REQ-1_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: Vue 组件开发者 | Task: 扩展 CityMap3D-AMap.vue，添加 defineProps 和 defineEmits，响应 props 变化更新地图视图 | Restrictions: 保持现有功能不变；使用 watchEffect 响应 props 变化 | Success: 可通过 props 控制地图，事件正确触发_\r\n\r\n- [ ] 3.2 创建 OpinionMarkerLayer 舆情标记组件\r\n\r\n  - File: `src/components/features/Map/OpinionMarkerLayer.vue`\r\n  - 根据舆情数据在地图上渲染标记点\r\n  - 按等级使用不同颜色，高危等级添加脉冲动画\r\n  - Purpose: 展示舆情空间分布\r\n  - _Leverage: 高德地图 Marker API, CityMap3D-AMap.vue_\r\n  - _Requirements: REQ-1_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: 地图可视化开发者 | Task: 创建 OpinionMarkerLayer，使用 AMap.Marker 渲染舆情点，颜色映射 (low=绿, medium=黄, high=橙, critical=红)，critical 级别添加 CSS 脉冲动画 | Restrictions: 使用 inject 获取地图实例；标记点需支持点击事件 | Success: 舆情点正确显示在地图上，点击可触发事件_\r\n\r\n- [ ] 3.3 创建 RegionHeatLayer 区域热力图组件\r\n\r\n  - File: `src/components/features/Map/RegionHeatLayer.vue`\r\n  - 实现区域舆情热力图显示\r\n  - 支持省/市/区县不同层级\r\n  - Purpose: 展示区域舆情热度\r\n  - _Leverage: 高德地图 Heatmap API_\r\n  - _Requirements: REQ-1, REQ-5_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: 热力图可视化开发者 | Task: 创建 RegionHeatLayer，使用 AMap.HeatMap 插件，支持显隐切换、数据更新、区域点击事件 | Restrictions: 热力图需与标记层可同时显示；性能优化大数据量渲染 | Success: 热力图正确显示区域热度_\r\n\r\n- [ ] 3.4 实现区域下钻功能\r\n  - File: `src/components/features/Map/CityMap3D-AMap.vue`\r\n  - 实现省->市->区县的层级切换\r\n  - 点击区域下钻，返回按钮上钻\r\n  - Purpose: 支持多层级舆情查看\r\n  - _Leverage: 高德地图行政区划 API, mapStore_\r\n  - _Requirements: REQ-5_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: 地图交互开发者 | Task: 实现区域下钻，使用高德 DistrictSearch 获取边界，点击区域切换视图，添加返回按钮；状态同步到 mapStore | Restrictions: 动画过渡需流畅；边界数据需缓存避免重复请求 | Success: 可从省级逐层下钻到区县级_\r\n\r\n## 4. 监测组件扩展\r\n\r\n- [ ] 4.1 扩展 NewsTicker 接入实时数据\r\n\r\n  - File: `src/components/features/Monitor/NewsTicker.vue`\r\n  - 接入 opinionStore 和 wsService\r\n  - 新舆情到达时自动添加到列表\r\n  - Purpose: 实现实时舆情滚动\r\n  - _Leverage: 现有 NewsTicker.vue, opinionStore, wsService_\r\n  - _Requirements: REQ-2_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: 实时数据组件开发者 | Task: 扩展 NewsTicker，从 opinionStore 获取数据，订阅 wsService 新舆情事件，新数据到达时添加到列表顶部并高亮 | Restrictions: 保持现有滚动动画；列表最大条目数限制 | Success: 新舆情实时显示，旧数据自动滚动_\r\n\r\n- [ ] 4.2 实现舆情条目点击定位联动\r\n  - File: `src/components/features/Monitor/NewsTicker.vue`\r\n  - 点击舆情条目时，地图定位到对应位置\r\n  - 同时选中对应的地图标记\r\n  - Purpose: 列表与地图联动\r\n  - _Leverage: NewsTicker.vue, mapStore, opinionStore_\r\n  - _Requirements: REQ-2_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: 组件联动开发者 | Task: 点击 NewsTicker 条目时，调用 mapStore.setCenter() 定位，opinionStore.selectOpinion() 选中，触发地图标记高亮 | Restrictions: 地图移动需平滑过渡；选中状态需双向同步 | Success: 点击列表项，地图自动定位并高亮标记_\r\n\r\n## 5. 分析组件扩展\r\n\r\n- [ ] 5.1 扩展 InsightCard 显示 AI 分析结果\r\n\r\n  - File: `src/components/features/Analysis/InsightCard.vue`\r\n  - 接入 analysisStore 显示分析数据\r\n  - 展示情感倾向、关键词、AI 摘要\r\n  - Purpose: 展示 AI 分析结论\r\n  - _Leverage: 现有 InsightCard.vue, analysisStore_\r\n  - _Requirements: REQ-3_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: 数据展示组件开发者 | Task: 扩展 InsightCard，从 analysisStore 获取当前选中舆情的分析结果，展示情感标签 (带颜色)、关键词云、AI 摘要、置信度指示器 | Restrictions: 无数据时显示空状态；加载中显示骨架屏 | Success: 分析结果正确展示_\r\n\r\n- [ ] 5.2 创建 TrendChart 趋势图表组件\r\n  - File: `src/components/features/Analysis/TrendChart.vue`\r\n  - 使用 ECharts 展示舆情趋势折线图\r\n  - 支持时间范围切换\r\n  - Purpose: 可视化舆情趋势\r\n  - _Leverage: echarts (已安装)_\r\n  - _Requirements: REQ-3_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: ECharts 图表开发者 | Task: 创建 TrendChart，使用 ECharts 折线图展示舆情数量趋势，支持 24h/7d/30d 时间范围切换，深色主题样式 | Restrictions: 图表需响应式适配容器；优化渲染性能 | Success: 趋势图表正确显示，支持时间切换_\r\n\r\n## 6. 决策模拟扩展\r\n\r\n- [ ] 6.1 扩展 DecisionPanel 方案选择功能\r\n\r\n  - File: `src/components/features/Simulation/DecisionPanel.vue`\r\n  - 接入 simulationStore\r\n  - 显示预设方案列表，支持选择\r\n  - Purpose: 提供决策方案选择\r\n  - _Leverage: 现有 DecisionPanel.vue, simulationStore_\r\n  - _Requirements: REQ-4_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: 交互组件开发者 | Task: 扩展 DecisionPanel，从 simulationStore 获取方案列表，显示方案卡片 (名称、描述、预测效果)，支持选择和查看详情 | Restrictions: 选中状态需视觉反馈；方案数据需支持动态加载 | Success: 可浏览和选择决策方案_\r\n\r\n- [ ] 6.2 实现模拟结果展示\r\n  - File: `src/components/features/Simulation/SimulationResult.vue`\r\n  - 创建模拟结果展示组件\r\n  - 对比不同方案的预测效果\r\n  - Purpose: 展示 AI 模拟结果\r\n  - _Leverage: simulationStore, ECharts_\r\n  - _Requirements: REQ-4_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: 数据可视化开发者 | Task: 创建 SimulationResult，展示方案对比图表 (柱状图/雷达图)，显示预测情感变化、传播范围、持续时间，附带置信度指示 | Restrictions: 支持多方案同时对比；图表需可交互 | Success: 模拟结果清晰对比展示_\r\n\r\n## 7. 集成与测试\r\n\r\n- [ ] 7.1 集成所有模块到 AppShell\r\n\r\n  - File: `src/components/layout/AppShell.vue`\r\n  - 连接所有 Store 和组件\r\n  - 实现全局状态初始化\r\n  - Purpose: 完成系统集成\r\n  - _Leverage: 所有已创建的 Store 和组件_\r\n  - _Requirements: All_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: 系统集成开发者 | Task: 在 AppShell 中初始化所有 Store，配置组件间通信，实现全局错误处理和加载状态管理 | Restrictions: 保持组件解耦；错误边界需捕获子组件异常 | Success: 系统各模块正确协作_\r\n\r\n- [ ] 7.2 添加 Mock 数据和开发环境配置\r\n\r\n  - File: `src/mocks/`, `vite.config.js`\r\n  - 创建完整的 mock 数据集\r\n  - 配置开发环境代理和 mock 服务\r\n  - Purpose: 支持独立前端开发\r\n  - _Leverage: vite.config.js_\r\n  - _Requirements: All_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: 开发环境配置专家 | Task: 创建 src/mocks/ 目录，包含舆情、分析、方案等 mock 数据；配置 Vite 开发服务器代理 | Restrictions: Mock 数据需覆盖所有边界情况；支持热更新 | Success: 前端可独立运行和开发_\r\n\r\n- [ ] 7.3 编写核心功能单元测试\r\n  - File: `src/__tests__/`\r\n  - 为 Store 和工具函数编写测试\r\n  - 配置 Vitest 测试环境\r\n  - Purpose: 保证代码质量\r\n  - _Leverage: vitest (需安装)_\r\n  - _Requirements: All_\r\n  - _Prompt: Implement the task for spec aicity-frontend: Role: 测试工程师 | Task: 配置 Vitest，为 opinionStore、mapStore 编写单元测试，覆盖核心 actions 和 getters | Restrictions: 测试需隔离运行；使用 mock 数据 | Success: 测试覆盖率 > 80%，测试全部通过_\r\n",
  "fileStats": {
    "size": 13292,
    "lines": 199,
    "lastModified": "2025-12-03T13:42:00.309Z"
  },
  "comments": []
}