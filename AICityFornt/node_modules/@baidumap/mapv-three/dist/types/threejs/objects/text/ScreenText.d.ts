/**
 * 屏幕文字对象, 支持沿线绘制文字
 *
 *
 * @category Objects
 */
export class ScreenText extends GeoMesh {
    /**
     * 构造函数
     * @param {Object} parameters 配置参数
     * @param {number} [parameters.fontSize=26] 字体大小
     * @param {string} [parameters.fontFamily='Arial'] 字体族
     * @param {string} [parameters.color='#ffffff'] 文字颜色
     * @param {number} [parameters.opacity=1] 不透明度
     * @param {number} [parameters.strokeWidth=0] 描边宽度
     * @param {string} [parameters.strokeColor='#000000'] 描边颜色
     */
    constructor(parameters?: {
        fontSize?: number | undefined;
        fontFamily?: string | undefined;
        color?: string | undefined;
        opacity?: number | undefined;
        strokeWidth?: number | undefined;
        strokeColor?: string | undefined;
    });
    /** @protected */ protected parameters: {
        fontSize: number;
        fontFamily: string;
        color: string;
        opacity: number;
        strokeWidth: number;
        strokeColor: string;
        fontWeight: string;
        keepUpright: boolean;
        textMaxAngle: number;
        clippingBuffer: number;
        debug: boolean;
    };
    /** @protected */ protected fontAtlasManager: any;
    /** @protected */ protected atlasTexture: any;
    frustumCulled: boolean;
    matrixAutoUpdate: boolean;
    renderOrder: number;
    FlipState: {
        unknown: number;
        flipRequired: number;
        flipNotRequired: number;
    };
    _flipStates: Map<any, any>;
    _textsAlongLinesData: any[];
    _tempMatrix4: any;
    _tempVector2: any;
    _tempVector4: any;
    _tempVector4_2: any;
    _measureCanvas: HTMLCanvasElement;
    _measureCtx: CanvasRenderingContext2D | null;
    _emptyFrameCount: number;
    _emptyFrameThreshold: number;
    _placeTextCache: Map<any, any>;
    _shapeCache: LRUCache;
    _debugPolyline: Polyline | null;
    _debugNormalPoints: SimplePoint | null;
    _debugAnchorPoints: SimplePoint | null;
    geometry: ScreenTextGeometry | undefined;
    material: ScreenTextMaterial | undefined;
    /**
     * 初始化调试对象
     * @private
     */
    private _initDebugObjects;
    /**
     * 碰撞检测（返回屏幕坐标的字符包围盒）
     * @param {Object} data 数据项（来自 dataSource.userData）
     * @returns {Object|null} 包围盒信息 {chars, isProjected, tolerance}
     */
    collisionTest(data: Object): Object | null;
    /**
     * 更新分辨率
     * @private
     */
    private _updateResolution;
    /**
     * 初始化字体图集管理器
     * @private
     */
    private _initFontAtlas;
    /**
     * 定义代理属性
     * @private
     */
    private _defineProxyProperties;
    /**
     * 设置文字数据（核心API）
     * @param {Array<Object>} chars 字符数据数组（注意：每个是单个字符！）
     * @param {number} chars[].x 屏幕X坐标（像素）
     * @param {number} chars[].y 屏幕Y坐标（像素）
     * @param {string} chars[].char 单个字符
     * @param {number} [chars[].rotation=0] 旋转角度（弧度）
     * @param {number} [chars[].size] 字符大小（可选，默认使用fontSize）
     * @example
     * ```javascript
     * screenText.setTexts([
     *     { x: 100, y: 100, char: '建', rotation: 0, size: 26 },
     *     { x: 126, y: 100, char: '国', rotation: 0, size: 26 },
     *     { x: 152, y: 100, char: '门', rotation: 0, size: 26 }
     * ]);
     * ```
     */
    setTexts(chars: Array<Object>): void;
    _lastCharCount: number | undefined;
    /**
     * 更新字体图集
     * @private
     */
    private _updateFontAtlas;
    /**
     * 沿线绘制单组文字（向后兼容）
     * @param {string} text 要显示的文字
     * @param {Array<Array<number>>} line 世界坐标线段数组 [[x,y,z], [x,y,z], ...]
     * @param {Array<number>} anchor 锚点世界坐标 [x,y,z]
     * @example
     * ```javascript
     * screenText.setTextAlongLine('建国门南大街', line, [x, y, z]);
     * ```
     */
    setTextAlongLine(text: string, line: Array<Array<number>>, anchor: Array<number>): void;
    /**
     * 沿线绘制多组文字
     * @param {Array<Object>} textsData 多组文字数据
     * @param {string} textsData[].text 要显示的文字
     * @param {Array<Array<number>>} textsData[].line 世界坐标线段数组
     * @param {Array<number>} textsData[].anchor 锚点世界坐标
     * @example
     * ```javascript
     * screenText.setTextsAlongLines([
     *     { text: '建国门南大街', line: line1, anchor: anchor1 },
     *     { text: '西便门大街', line: line2, anchor: anchor2 }
     * ]);
     * ```
     */
    setTextsAlongLines(textsData: Array<Object>): void;
    /**
     * 渲染前更新
     * @internal
     */
    onBeforeScenePrepareRenderHook(renderer: any, scene: any, camera: any): void;
    /**
     * 更新多组沿线文字（新方法）
     * @private
     */
    private _updateTextsAlongLines;
    /**
     * 放置单组沿线文字（重构后的核心方法）
     * @private
     * @returns {Array} 字符数组，如果过滤则返回空数组
     */
    private _placeTextAlongLine;
    _initializedGroups: Set<any> | undefined;
    /**
     * 解析颜色为RGBA数组（归一化到0-1）
     * @private
     * @param {string|Array} color - 颜色值（支持多种格式）
     * @param {string} defaultColor - 默认颜色（十六进制）
     * @returns {Array} RGBA数组 [r, g, b, a]（0-1范围）
     */
    private _parseColorToRgba;
    /**
     * 文字形状化（计算每个字符的位置和宽度）
     * @private
     */
    private _shapeText;
    /**
     * 计算两点距离
     * @private
     */
    private _distance;
    /**
     * 将世界坐标线段转换为屏幕坐标
     * 包含近平面裁剪处理（处理 w < 0 的情况）
     * @private
     */
    private _lineToScreenCoords;
    /**
     * 世界坐标转屏幕坐标
     * @private
     */
    private _worldToScreen;
    /**
     * 查找锚点所在的线段
     * @private
     */
    private _findSegmentForAnchor;
    /**
     * 计算点到线段的最短距离
     * @private
     */
    private _pointToSegmentDistance;
    /**
     * 判断锚点是否在屏幕可见区域内
     * @private
     */
    private _isAnchorVisible;
    /**
     * 判断点是否在相机后面（w <= 0）
     * @private
     */
    private _isPointBehindCamera;
    /**
     * 判断是否在翻转保持范围内
     * @private
     */
    private _isInFlipRetainRange;
    /**
     * 判断是否需要改变朝向（Mapbox 完整算法）
     * @private
     */
    private _requiresOrientationChange;
    /**
     * 沿线放置字符
     * @private
     */
    private _placeGlyphAlongLine;
    _placeGlyphDebugDone: boolean | undefined;
    /**
     * 更新调试对象的数据
     * @private
     */
    private _updateDebugObjects;
    /**
     * 显示 Atlas 纹理调试面板
     * @param {Object} options 配置选项
     * @param {number} [options.size=300] 显示尺寸（像素）
     * @param {string} [options.position='top-right'] 位置：'top-left', 'top-right', 'bottom-left', 'bottom-right'
     * @param {boolean} [options.autoUpdate=true] 是否自动更新
     * @example
     * ```javascript
     * screenText.showAtlasDebug({ size: 400, position: 'bottom-right' });
     * ```
     */
    showAtlasDebug(options?: {
        size?: number | undefined;
        position?: string | undefined;
        autoUpdate?: boolean | undefined;
    }): this;
    _debugPanel: HTMLDivElement | null | undefined;
    _debugUpdateInterval: number | null | undefined;
    /**
     * 隐藏 Atlas 纹理调试面板
     */
    hideAtlasDebug(): this;
    /**
     * 获取 Atlas 纹理（用于自定义调试）
     * @returns {DataTexture} Atlas texture
     */
    getAtlasTexture(): DataTexture;
    /**
     * 获取字体图集管理器
     * @returns {FontAtlasManager} Font atlas manager
     */
    getFontAtlasManager(): FontAtlasManager;
    /**
     * 获取字符集合（从实际的atlas mapping中提取）
     * @returns {Set} 字符集合
     */
    getCharacterSet(): Set<any>;
}
import { GeoMesh } from '../GeoMesh';
import { LRUCache } from '../../../util/LRUCache';
import { Polyline } from '../line/Polyline';
import { SimplePoint } from '../point/SimplePoint';
import { ScreenTextGeometry } from '../../geometries/text/ScreenTextGeometry';
import { ScreenTextMaterial } from '../../materials/text/ScreenTextMaterial';
import { FontAtlasManager } from './font-atlas-manager';
